var _e=Object.defineProperty;var be=(K,T,X)=>T in K?_e(K,T,{enumerable:!0,configurable:!0,writable:!0,value:X}):K[T]=X;var y=(K,T,X)=>(be(K,typeof T!="symbol"?T+"":T,X),X);var __vite_style__=document.createElement("style");__vite_style__.innerHTML=`html,body,#image-map{width:100%;height:100%;margin:0;padding:0}#diff-map,#union-map,#intersection-map{display:none;width:400px;height:400px;margin-right:10px;float:left}
`;document.head.appendChild(__vite_style__);(function(K,T){"use strict";const X=o=>o&&typeof o=="object"&&"default"in o?o:{default:o};function Rt(o){if(o&&o.__esModule)return o;const i=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(o){for(const e in o)if(e!=="default"){const r=Object.getOwnPropertyDescriptor(o,e);Object.defineProperty(i,e,r.get?r:{enumerable:!0,get:()=>o[e]})}}return i.default=o,Object.freeze(i)}const b=X(K),vt=Rt(T),ke=function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}},ye="";var Pt={exports:{}};(function(o,i){(function(e,r){o.exports=e(b.default),typeof r<"u"&&r.L&&e(r.L)})(function(e){e.Editable=e.Evented.extend({statics:{FORWARD:1,BACKWARD:-1},options:{zIndex:1e3,polygonClass:e.Polygon,polylineClass:e.Polyline,markerClass:e.Marker,rectangleClass:e.Rectangle,circleClass:e.Circle,drawingCSSClass:"leaflet-editable-drawing",drawingCursor:"crosshair",editLayer:void 0,featuresLayer:void 0,polylineEditorClass:void 0,polygonEditorClass:void 0,markerEditorClass:void 0,rectangleEditorClass:void 0,circleEditorClass:void 0,lineGuideOptions:{},skipMiddleMarkers:!1},initialize:function(t,n){e.setOptions(this,n),this._lastZIndex=this.options.zIndex,this.map=t,this.editLayer=this.createEditLayer(),this.featuresLayer=this.createFeaturesLayer(),this.forwardLineGuide=this.createLineGuide(),this.backwardLineGuide=this.createLineGuide()},fireAndForward:function(t,n){n=n||{},n.editTools=this,this.fire(t,n),this.map.fire(t,n)},createLineGuide:function(){var t=e.extend({dashArray:"5,10",weight:1,interactive:!1},this.options.lineGuideOptions);return e.polyline([],t)},createVertexIcon:function(t){return e.Browser.mobile&&e.Browser.touch?new e.Editable.TouchVertexIcon(t):new e.Editable.VertexIcon(t)},createEditLayer:function(){return this.options.editLayer||new e.LayerGroup().addTo(this.map)},createFeaturesLayer:function(){return this.options.featuresLayer||new e.LayerGroup().addTo(this.map)},moveForwardLineGuide:function(t){this.forwardLineGuide._latlngs.length&&(this.forwardLineGuide._latlngs[1]=t,this.forwardLineGuide._bounds.extend(t),this.forwardLineGuide.redraw())},moveBackwardLineGuide:function(t){this.backwardLineGuide._latlngs.length&&(this.backwardLineGuide._latlngs[1]=t,this.backwardLineGuide._bounds.extend(t),this.backwardLineGuide.redraw())},anchorForwardLineGuide:function(t){this.forwardLineGuide._latlngs[0]=t,this.forwardLineGuide._bounds.extend(t),this.forwardLineGuide.redraw()},anchorBackwardLineGuide:function(t){this.backwardLineGuide._latlngs[0]=t,this.backwardLineGuide._bounds.extend(t),this.backwardLineGuide.redraw()},attachForwardLineGuide:function(){this.editLayer.addLayer(this.forwardLineGuide)},attachBackwardLineGuide:function(){this.editLayer.addLayer(this.backwardLineGuide)},detachForwardLineGuide:function(){this.forwardLineGuide.setLatLngs([]),this.editLayer.removeLayer(this.forwardLineGuide)},detachBackwardLineGuide:function(){this.backwardLineGuide.setLatLngs([]),this.editLayer.removeLayer(this.backwardLineGuide)},blockEvents:function(){this._oldTargets||(this._oldTargets=this.map._targets,this.map._targets={})},unblockEvents:function(){this._oldTargets&&(this.map._targets=e.extend(this.map._targets,this._oldTargets),delete this._oldTargets)},registerForDrawing:function(t){this._drawingEditor&&this.unregisterForDrawing(this._drawingEditor),this.blockEvents(),t.reset(),this._drawingEditor=t,this.map.on("mousemove touchmove",t.onDrawingMouseMove,t),this.map.on("mousedown",this.onMousedown,this),this.map.on("mouseup",this.onMouseup,this),e.DomUtil.addClass(this.map._container,this.options.drawingCSSClass),this.defaultMapCursor=this.map._container.style.cursor,this.map._container.style.cursor=this.options.drawingCursor},unregisterForDrawing:function(t){this.unblockEvents(),e.DomUtil.removeClass(this.map._container,this.options.drawingCSSClass),this.map._container.style.cursor=this.defaultMapCursor,t=t||this._drawingEditor,t&&(this.map.off("mousemove touchmove",t.onDrawingMouseMove,t),this.map.off("mousedown",this.onMousedown,this),this.map.off("mouseup",this.onMouseup,this),t===this._drawingEditor&&(delete this._drawingEditor,t._drawing&&t.cancelDrawing()))},onMousedown:function(t){t.originalEvent.which==1&&(this._mouseDown=t,this._drawingEditor.onDrawingMouseDown(t))},onMouseup:function(t){if(this._mouseDown){var n=this._drawingEditor,l=this._mouseDown;if(this._mouseDown=null,n.onDrawingMouseUp(t),this._drawingEditor!==n)return;var f=e.point(l.originalEvent.clientX,l.originalEvent.clientY),p=e.point(t.originalEvent.clientX,t.originalEvent.clientY).distanceTo(f);Math.abs(p)<9*(window.devicePixelRatio||1)&&this._drawingEditor.onDrawingClick(t)}},drawing:function(){return this._drawingEditor&&this._drawingEditor.drawing()},stopDrawing:function(){this.unregisterForDrawing()},commitDrawing:function(t){!this._drawingEditor||this._drawingEditor.commitDrawing(t)},connectCreatedToMap:function(t){return this.featuresLayer.addLayer(t)},startPolyline:function(t,n){var l=this.createPolyline([],n);return l.enableEdit(this.map).newShape(t),l},startPolygon:function(t,n){var l=this.createPolygon([],n);return l.enableEdit(this.map).newShape(t),l},startMarker:function(t,n){t=t||this.map.getCenter().clone();var l=this.createMarker(t,n);return l.enableEdit(this.map).startDrawing(),l},startRectangle:function(t,n){var l=t||e.latLng([0,0]),f=new e.LatLngBounds(l,l),p=this.createRectangle(f,n);return p.enableEdit(this.map).startDrawing(),p},startCircle:function(t,n){t=t||this.map.getCenter().clone();var l=this.createCircle(t,n);return l.enableEdit(this.map).startDrawing(),l},startHole:function(t,n){t.newHole(n)},createLayer:function(t,n,l){l=e.Util.extend({editOptions:{editTools:this}},l);var f=new t(n,l);return this.fireAndForward("editable:created",{layer:f}),f},createPolyline:function(t,n){return this.createLayer(n&&n.polylineClass||this.options.polylineClass,t,n)},createPolygon:function(t,n){return this.createLayer(n&&n.polygonClass||this.options.polygonClass,t,n)},createMarker:function(t,n){return this.createLayer(n&&n.markerClass||this.options.markerClass,t,n)},createRectangle:function(t,n){return this.createLayer(n&&n.rectangleClass||this.options.rectangleClass,t,n)},createCircle:function(t,n){return this.createLayer(n&&n.circleClass||this.options.circleClass,t,n)}}),e.extend(e.Editable,{makeCancellable:function(t){t.cancel=function(){t._cancelled=!0}}}),e.Map.mergeOptions({editToolsClass:e.Editable,editable:!1,editOptions:{}}),e.Map.addInitHook(function(){this.whenReady(function(){this.options.editable&&(this.editTools=new this.options.editToolsClass(this,this.options.editOptions))})}),e.Editable.VertexIcon=e.DivIcon.extend({options:{iconSize:new e.Point(8,8)}}),e.Editable.TouchVertexIcon=e.Editable.VertexIcon.extend({options:{iconSize:new e.Point(20,20)}}),e.Editable.VertexMarker=e.Marker.extend({options:{draggable:!0,className:"leaflet-div-icon leaflet-vertex-icon"},initialize:function(t,n,l,f){this.latlng=t,this.latlngs=n,this.editor=l,e.Marker.prototype.initialize.call(this,t,f),this.options.icon=this.editor.tools.createVertexIcon({className:this.options.className}),this.latlng.__vertex=this,this.editor.editLayer.addLayer(this),this.setZIndexOffset(l.tools._lastZIndex+1)},onAdd:function(t){e.Marker.prototype.onAdd.call(this,t),this.on("drag",this.onDrag),this.on("dragstart",this.onDragStart),this.on("dragend",this.onDragEnd),this.on("mouseup",this.onMouseup),this.on("click",this.onClick),this.on("contextmenu",this.onContextMenu),this.on("mousedown touchstart",this.onMouseDown),this.on("mouseover",this.onMouseOver),this.on("mouseout",this.onMouseOut),this.addMiddleMarkers()},onRemove:function(t){this.middleMarker&&this.middleMarker.delete(),delete this.latlng.__vertex,this.off("drag",this.onDrag),this.off("dragstart",this.onDragStart),this.off("dragend",this.onDragEnd),this.off("mouseup",this.onMouseup),this.off("click",this.onClick),this.off("contextmenu",this.onContextMenu),this.off("mousedown touchstart",this.onMouseDown),this.off("mouseover",this.onMouseOver),this.off("mouseout",this.onMouseOut),e.Marker.prototype.onRemove.call(this,t)},onDrag:function(t){t.vertex=this,this.editor.onVertexMarkerDrag(t);var n=e.DomUtil.getPosition(this._icon),l=this._map.layerPointToLatLng(n);this.latlng.update(l),this._latlng=this.latlng,this.editor.refresh(),this.middleMarker&&this.middleMarker.updateLatLng();var f=this.getNext();f&&f.middleMarker&&f.middleMarker.updateLatLng()},onDragStart:function(t){t.vertex=this,this.editor.onVertexMarkerDragStart(t)},onDragEnd:function(t){t.vertex=this,this.editor.onVertexMarkerDragEnd(t)},onClick:function(t){t.vertex=this,this.editor.onVertexMarkerClick(t)},onMouseup:function(t){e.DomEvent.stop(t),t.vertex=this,this.editor.map.fire("mouseup",t)},onContextMenu:function(t){t.vertex=this,this.editor.onVertexMarkerContextMenu(t)},onMouseDown:function(t){t.vertex=this,this.editor.onVertexMarkerMouseDown(t)},onMouseOver:function(t){t.vertex=this,this.editor.onVertexMarkerMouseOver(t)},onMouseOut:function(t){t.vertex=this,this.editor.onVertexMarkerMouseOut(t)},delete:function(){var t=this.getNext();this.latlngs.splice(this.getIndex(),1),this.editor.editLayer.removeLayer(this),this.editor.onVertexDeleted({latlng:this.latlng,vertex:this}),this.latlngs.length||this.editor.deleteShape(this.latlngs),t&&t.resetMiddleMarker(),this.editor.refresh()},getIndex:function(){return this.latlngs.indexOf(this.latlng)},getLastIndex:function(){return this.latlngs.length-1},getPrevious:function(){if(!(this.latlngs.length<2)){var t=this.getIndex(),n=t-1;t===0&&this.editor.CLOSED&&(n=this.getLastIndex());var l=this.latlngs[n];if(l)return l.__vertex}},getNext:function(){if(!(this.latlngs.length<2)){var t=this.getIndex(),n=t+1;t===this.getLastIndex()&&this.editor.CLOSED&&(n=0);var l=this.latlngs[n];if(l)return l.__vertex}},addMiddleMarker:function(t){!this.editor.hasMiddleMarkers()||(t=t||this.getPrevious(),t&&!this.middleMarker&&(this.middleMarker=this.editor.addMiddleMarker(t,this,this.latlngs,this.editor)))},addMiddleMarkers:function(){if(!!this.editor.hasMiddleMarkers()){var t=this.getPrevious();t&&this.addMiddleMarker(t);var n=this.getNext();n&&n.resetMiddleMarker()}},resetMiddleMarker:function(){this.middleMarker&&this.middleMarker.delete(),this.addMiddleMarker()},split:function(){!this.editor.splitShape||this.editor.splitShape(this.latlngs,this.getIndex())},continue:function(){if(!!this.editor.continueBackward){var t=this.getIndex();t===0?this.editor.continueBackward(this.latlngs):t===this.getLastIndex()&&this.editor.continueForward(this.latlngs)}}}),e.Editable.mergeOptions({vertexMarkerClass:e.Editable.VertexMarker}),e.Editable.MiddleMarker=e.Marker.extend({options:{opacity:.5,className:"leaflet-div-icon leaflet-middle-icon",draggable:!0},initialize:function(t,n,l,f,p){this.left=t,this.right=n,this.editor=f,this.latlngs=l,e.Marker.prototype.initialize.call(this,this.computeLatLng(),p),this._opacity=this.options.opacity,this.options.icon=this.editor.tools.createVertexIcon({className:this.options.className}),this.editor.editLayer.addLayer(this),this.setVisibility()},setVisibility:function(){var t=this._map.latLngToContainerPoint(this.left.latlng),n=this._map.latLngToContainerPoint(this.right.latlng),l=e.point(this.options.icon.options.iconSize);t.distanceTo(n)<l.x*3?this.hide():this.show()},show:function(){this.setOpacity(this._opacity)},hide:function(){this.setOpacity(0)},updateLatLng:function(){this.setLatLng(this.computeLatLng()),this.setVisibility()},computeLatLng:function(){var t=this.editor.map.latLngToContainerPoint(this.left.latlng),n=this.editor.map.latLngToContainerPoint(this.right.latlng),l=(t.y+n.y)/2,f=(t.x+n.x)/2;return this.editor.map.containerPointToLatLng([f,l])},onAdd:function(t){e.Marker.prototype.onAdd.call(this,t),e.DomEvent.on(this._icon,"mousedown touchstart",this.onMouseDown,this),t.on("zoomend",this.setVisibility,this)},onRemove:function(t){delete this.right.middleMarker,e.DomEvent.off(this._icon,"mousedown touchstart",this.onMouseDown,this),t.off("zoomend",this.setVisibility,this),e.Marker.prototype.onRemove.call(this,t)},onMouseDown:function(t){var n=e.DomUtil.getPosition(this._icon),l=this.editor.map.layerPointToLatLng(n);if(t={originalEvent:t,latlng:l},this.options.opacity!==0&&(e.Editable.makeCancellable(t),this.editor.onMiddleMarkerMouseDown(t),!t._cancelled)){this.latlngs.splice(this.index(),0,t.latlng),this.editor.refresh();var f=this._icon,p=this.editor.addVertexMarker(t.latlng,this.latlngs);this.editor.onNewVertex(p);var v=p._icon.parentNode;v.removeChild(p._icon),p._icon=f,v.appendChild(p._icon),p._initIcon(),p._initInteraction(),p.setOpacity(1),e.Draggable._dragging=!1,p.dragging._draggable._onDown(t.originalEvent),this.delete()}},delete:function(){this.editor.editLayer.removeLayer(this)},index:function(){return this.latlngs.indexOf(this.right.latlng)}}),e.Editable.mergeOptions({middleMarkerClass:e.Editable.MiddleMarker}),e.Editable.BaseEditor=e.Handler.extend({initialize:function(t,n,l){e.setOptions(this,l),this.map=t,this.feature=n,this.feature.editor=this,this.editLayer=new e.LayerGroup,this.tools=this.options.editTools||t.editTools},addHooks:function(){this.isConnected()?this.onFeatureAdd():this.feature.once("add",this.onFeatureAdd,this),this.onEnable(),this.feature.on(this._getEvents(),this)},removeHooks:function(){this.feature.off(this._getEvents(),this),this.feature.dragging&&this.feature.dragging.disable(),this.editLayer.clearLayers(),this.tools.editLayer.removeLayer(this.editLayer),this.onDisable(),this._drawing&&this.cancelDrawing()},drawing:function(){return!!this._drawing},reset:function(){},onFeatureAdd:function(){this.tools.editLayer.addLayer(this.editLayer),this.feature.dragging&&this.feature.dragging.enable()},hasMiddleMarkers:function(){return!this.options.skipMiddleMarkers&&!this.tools.options.skipMiddleMarkers},fireAndForward:function(t,n){n=n||{},n.layer=this.feature,this.feature.fire(t,n),this.tools.fireAndForward(t,n)},onEnable:function(){this.fireAndForward("editable:enable")},onDisable:function(){this.fireAndForward("editable:disable")},onEditing:function(){this.fireAndForward("editable:editing")},onStartDrawing:function(){this.fireAndForward("editable:drawing:start")},onEndDrawing:function(){this.fireAndForward("editable:drawing:end")},onCancelDrawing:function(){this.fireAndForward("editable:drawing:cancel")},onCommitDrawing:function(t){this.fireAndForward("editable:drawing:commit",t)},onDrawingMouseDown:function(t){this.fireAndForward("editable:drawing:mousedown",t)},onDrawingMouseUp:function(t){this.fireAndForward("editable:drawing:mouseup",t)},startDrawing:function(){this._drawing||(this._drawing=e.Editable.FORWARD),this.tools.registerForDrawing(this),this.onStartDrawing()},commitDrawing:function(t){this.onCommitDrawing(t),this.endDrawing()},cancelDrawing:function(){e.Draggable._dragging=!1,this.onCancelDrawing(),this.endDrawing()},endDrawing:function(){this._drawing=!1,this.tools.unregisterForDrawing(this),this.onEndDrawing()},onDrawingClick:function(t){!this.drawing()||(e.Editable.makeCancellable(t),this.fireAndForward("editable:drawing:click",t),!t._cancelled&&(this.isConnected()||this.connect(t),this.processDrawingClick(t)))},isConnected:function(){return this.map.hasLayer(this.feature)},connect:function(){this.tools.connectCreatedToMap(this.feature),this.tools.editLayer.addLayer(this.editLayer)},onMove:function(t){this.fireAndForward("editable:drawing:move",t)},onDrawingMouseMove:function(t){this.onMove(t)},_getEvents:function(){return{dragstart:this.onDragStart,drag:this.onDrag,dragend:this.onDragEnd,remove:this.disable}},onDragStart:function(t){this.onEditing(),this.fireAndForward("editable:dragstart",t)},onDrag:function(t){this.onMove(t),this.fireAndForward("editable:drag",t)},onDragEnd:function(t){this.fireAndForward("editable:dragend",t)}}),e.Editable.MarkerEditor=e.Editable.BaseEditor.extend({onDrawingMouseMove:function(t){e.Editable.BaseEditor.prototype.onDrawingMouseMove.call(this,t),this._drawing&&this.feature.setLatLng(t.latlng)},processDrawingClick:function(t){this.fireAndForward("editable:drawing:clicked",t),this.commitDrawing(t)},connect:function(t){t&&(this.feature._latlng=t.latlng),e.Editable.BaseEditor.prototype.connect.call(this,t)}}),e.Editable.PathEditor=e.Editable.BaseEditor.extend({CLOSED:!1,MIN_VERTEX:2,addHooks:function(){return e.Editable.BaseEditor.prototype.addHooks.call(this),this.feature&&this.initVertexMarkers(),this},initVertexMarkers:function(t){if(!!this.enabled())if(t=t||this.getLatLngs(),c(t))this.addVertexMarkers(t);else for(var n=0;n<t.length;n++)this.initVertexMarkers(t[n])},getLatLngs:function(){return this.feature.getLatLngs()},reset:function(){this.editLayer.clearLayers(),this.initVertexMarkers()},addVertexMarker:function(t,n){return new this.tools.options.vertexMarkerClass(t,n,this)},onNewVertex:function(t){this.fireAndForward("editable:vertex:new",{latlng:t.latlng,vertex:t})},addVertexMarkers:function(t){for(var n=0;n<t.length;n++)this.addVertexMarker(t[n],t)},refreshVertexMarkers:function(t){t=t||this.getDefaultLatLngs();for(var n=0;n<t.length;n++)t[n].__vertex.update()},addMiddleMarker:function(t,n,l){return new this.tools.options.middleMarkerClass(t,n,l,this)},onVertexMarkerClick:function(t){if(e.Editable.makeCancellable(t),this.fireAndForward("editable:vertex:click",t),!t._cancelled&&!(this.tools.drawing()&&this.tools._drawingEditor!==this)){var n=t.vertex.getIndex(),l;t.originalEvent.ctrlKey?this.onVertexMarkerCtrlClick(t):t.originalEvent.altKey?this.onVertexMarkerAltClick(t):t.originalEvent.shiftKey?this.onVertexMarkerShiftClick(t):t.originalEvent.metaKey?this.onVertexMarkerMetaKeyClick(t):n===t.vertex.getLastIndex()&&this._drawing===e.Editable.FORWARD?n>=this.MIN_VERTEX-1&&(l=!0):n===0&&this._drawing===e.Editable.BACKWARD&&this._drawnLatLngs.length>=this.MIN_VERTEX||n===0&&this._drawing===e.Editable.FORWARD&&this._drawnLatLngs.length>=this.MIN_VERTEX&&this.CLOSED?l=!0:this.onVertexRawMarkerClick(t),this.fireAndForward("editable:vertex:clicked",t),l&&this.commitDrawing(t)}},onVertexRawMarkerClick:function(t){this.fireAndForward("editable:vertex:rawclick",t),!t._cancelled&&(!this.vertexCanBeDeleted(t.vertex)||t.vertex.delete())},vertexCanBeDeleted:function(t){return t.latlngs.length>this.MIN_VERTEX},onVertexDeleted:function(t){this.fireAndForward("editable:vertex:deleted",t)},onVertexMarkerCtrlClick:function(t){this.fireAndForward("editable:vertex:ctrlclick",t)},onVertexMarkerShiftClick:function(t){this.fireAndForward("editable:vertex:shiftclick",t)},onVertexMarkerMetaKeyClick:function(t){this.fireAndForward("editable:vertex:metakeyclick",t)},onVertexMarkerAltClick:function(t){this.fireAndForward("editable:vertex:altclick",t)},onVertexMarkerContextMenu:function(t){this.fireAndForward("editable:vertex:contextmenu",t)},onVertexMarkerMouseDown:function(t){this.fireAndForward("editable:vertex:mousedown",t)},onVertexMarkerMouseOver:function(t){this.fireAndForward("editable:vertex:mouseover",t)},onVertexMarkerMouseOut:function(t){this.fireAndForward("editable:vertex:mouseout",t)},onMiddleMarkerMouseDown:function(t){this.fireAndForward("editable:middlemarker:mousedown",t)},onVertexMarkerDrag:function(t){this.onMove(t),this.feature._bounds&&this.extendBounds(t),this.fireAndForward("editable:vertex:drag",t)},onVertexMarkerDragStart:function(t){this.fireAndForward("editable:vertex:dragstart",t)},onVertexMarkerDragEnd:function(t){this.fireAndForward("editable:vertex:dragend",t)},setDrawnLatLngs:function(t){this._drawnLatLngs=t||this.getDefaultLatLngs()},startDrawing:function(){this._drawnLatLngs||this.setDrawnLatLngs(),e.Editable.BaseEditor.prototype.startDrawing.call(this)},startDrawingForward:function(){this.startDrawing()},endDrawing:function(){this.tools.detachForwardLineGuide(),this.tools.detachBackwardLineGuide(),this._drawnLatLngs&&this._drawnLatLngs.length<this.MIN_VERTEX&&this.deleteShape(this._drawnLatLngs),e.Editable.BaseEditor.prototype.endDrawing.call(this),delete this._drawnLatLngs},addLatLng:function(t){this._drawing===e.Editable.FORWARD?this._drawnLatLngs.push(t):this._drawnLatLngs.unshift(t),this.feature._bounds.extend(t);var n=this.addVertexMarker(t,this._drawnLatLngs);this.onNewVertex(n),this.refresh()},newPointForward:function(t){this.addLatLng(t),this.tools.attachForwardLineGuide(),this.tools.anchorForwardLineGuide(t)},newPointBackward:function(t){this.addLatLng(t),this.tools.anchorBackwardLineGuide(t)},push:function(t){if(!t)return console.error("L.Editable.PathEditor.push expect a valid latlng as parameter");this._drawing===e.Editable.FORWARD?this.newPointForward(t):this.newPointBackward(t)},removeLatLng:function(t){t.__vertex.delete(),this.refresh()},pop:function(){if(!(this._drawnLatLngs.length<=1)){var t;return this._drawing===e.Editable.FORWARD?t=this._drawnLatLngs[this._drawnLatLngs.length-1]:t=this._drawnLatLngs[0],this.removeLatLng(t),this._drawing===e.Editable.FORWARD?this.tools.anchorForwardLineGuide(this._drawnLatLngs[this._drawnLatLngs.length-1]):this.tools.anchorForwardLineGuide(this._drawnLatLngs[0]),t}},processDrawingClick:function(t){t.vertex&&t.vertex.editor===this||(this._drawing===e.Editable.FORWARD?this.newPointForward(t.latlng):this.newPointBackward(t.latlng),this.fireAndForward("editable:drawing:clicked",t))},onDrawingMouseMove:function(t){e.Editable.BaseEditor.prototype.onDrawingMouseMove.call(this,t),this._drawing&&(this.tools.moveForwardLineGuide(t.latlng),this.tools.moveBackwardLineGuide(t.latlng))},refresh:function(){this.feature.redraw(),this.onEditing()},newShape:function(t){var n=this.addNewEmptyShape();!n||(this.setDrawnLatLngs(n[0]||n),this.startDrawingForward(),this.fireAndForward("editable:shape:new",{shape:n}),t&&this.newPointForward(t))},deleteShape:function(t,n){var l={shape:t};if(e.Editable.makeCancellable(l),this.fireAndForward("editable:shape:delete",l),!l._cancelled)return t=this._deleteShape(t,n),this.ensureNotFlat&&this.ensureNotFlat(),this.feature.setLatLngs(this.getLatLngs()),this.refresh(),this.reset(),this.fireAndForward("editable:shape:deleted",{shape:t}),t},_deleteShape:function(t,n){if(n=n||this.getLatLngs(),!!n.length){var l=this,f=function(w,m){return m=w.splice(0,Number.MAX_VALUE),m},p=function(w,m){return w.splice(w.indexOf(m),1),w.length||l._deleteShape(w),m};if(n===t)return f(n,t);for(var v=0;v<n.length;v++){if(n[v]===t)return p(n,t);if(n[v].indexOf(t)!==-1)return p(n[v],t)}}},deleteShapeAt:function(t){var n=this.feature.shapeAt(t);if(n)return this.deleteShape(n)},appendShape:function(t){this.insertShape(t)},prependShape:function(t){this.insertShape(t,0)},insertShape:function(t,n){this.ensureMulti(),t=this.formatShape(t),typeof n>"u"&&(n=this.feature._latlngs.length),this.feature._latlngs.splice(n,0,t),this.feature.redraw(),this._enabled&&this.reset()},extendBounds:function(t){this.feature._bounds.extend(t.vertex.latlng)},onDragStart:function(t){this.editLayer.clearLayers(),e.Editable.BaseEditor.prototype.onDragStart.call(this,t)},onDragEnd:function(t){this.initVertexMarkers(),e.Editable.BaseEditor.prototype.onDragEnd.call(this,t)}}),e.Editable.PolylineEditor=e.Editable.PathEditor.extend({startDrawingBackward:function(){this._drawing=e.Editable.BACKWARD,this.startDrawing()},continueBackward:function(t){this.drawing()||(t=t||this.getDefaultLatLngs(),this.setDrawnLatLngs(t),t.length>0&&(this.tools.attachBackwardLineGuide(),this.tools.anchorBackwardLineGuide(t[0])),this.startDrawingBackward())},continueForward:function(t){this.drawing()||(t=t||this.getDefaultLatLngs(),this.setDrawnLatLngs(t),t.length>0&&(this.tools.attachForwardLineGuide(),this.tools.anchorForwardLineGuide(t[t.length-1])),this.startDrawingForward())},getDefaultLatLngs:function(t){return t=t||this.feature._latlngs,!t.length||t[0]instanceof e.LatLng?t:this.getDefaultLatLngs(t[0])},ensureMulti:function(){this.feature._latlngs.length&&c(this.feature._latlngs)&&(this.feature._latlngs=[this.feature._latlngs])},addNewEmptyShape:function(){if(this.feature._latlngs.length){var t=[];return this.appendShape(t),t}else return this.feature._latlngs},formatShape:function(t){if(c(t))return t;if(t[0])return this.formatShape(t[0])},splitShape:function(t,n){if(!(!n||n>=t.length-1)){this.ensureMulti();var l=this.feature._latlngs.indexOf(t);if(l!==-1){var f=t.slice(0,n+1),p=t.slice(n);p[0]=e.latLng(p[0].lat,p[0].lng,p[0].alt),this.feature._latlngs.splice(l,1,f,p),this.refresh(),this.reset()}}}}),e.Editable.PolygonEditor=e.Editable.PathEditor.extend({CLOSED:!0,MIN_VERTEX:3,newPointForward:function(t){e.Editable.PathEditor.prototype.newPointForward.call(this,t),this.tools.backwardLineGuide._latlngs.length||this.tools.anchorBackwardLineGuide(t),this._drawnLatLngs.length===2&&this.tools.attachBackwardLineGuide()},addNewEmptyHole:function(t){this.ensureNotFlat();var n=this.feature.shapeAt(t);if(!!n){var l=[];return n.push(l),l}},newHole:function(t){var n=this.addNewEmptyHole(t);!n||(this.setDrawnLatLngs(n),this.startDrawingForward(),t&&this.newPointForward(t))},addNewEmptyShape:function(){if(this.feature._latlngs.length&&this.feature._latlngs[0].length){var t=[];return this.appendShape(t),t}else return this.feature._latlngs},ensureMulti:function(){this.feature._latlngs.length&&c(this.feature._latlngs[0])&&(this.feature._latlngs=[this.feature._latlngs])},ensureNotFlat:function(){(!this.feature._latlngs.length||c(this.feature._latlngs))&&(this.feature._latlngs=[this.feature._latlngs])},vertexCanBeDeleted:function(t){var n=this.feature.parentShape(t.latlngs),l=e.Util.indexOf(n,t.latlngs);return l>0?!0:e.Editable.PathEditor.prototype.vertexCanBeDeleted.call(this,t)},getDefaultLatLngs:function(){return this.feature._latlngs.length||this.feature._latlngs.push([]),this.feature._latlngs[0]},formatShape:function(t){return c(t)&&(!t[0]||t[0].length!==0)?[t]:t}}),e.Editable.RectangleEditor=e.Editable.PathEditor.extend({CLOSED:!0,MIN_VERTEX:4,options:{skipMiddleMarkers:!0},extendBounds:function(t){var n=t.vertex.getIndex(),l=t.vertex.getNext(),f=t.vertex.getPrevious(),p=(n+2)%4,v=t.vertex.latlngs[p],w=new e.LatLngBounds(t.latlng,v);f.latlng.update([t.latlng.lat,v.lng]),l.latlng.update([v.lat,t.latlng.lng]),this.updateBounds(w),this.refreshVertexMarkers()},onDrawingMouseDown:function(t){e.Editable.PathEditor.prototype.onDrawingMouseDown.call(this,t),this.connect();var n=this.getDefaultLatLngs();n.length===3&&n.push(t.latlng);var l=new e.LatLngBounds(t.latlng,t.latlng);this.updateBounds(l),this.updateLatLngs(l),this.refresh(),this.reset(),t.originalEvent._simulated=!1,this.map.dragging._draggable._onUp(t.originalEvent),n[3].__vertex.dragging._draggable._onDown(t.originalEvent)},onDrawingMouseUp:function(t){this.commitDrawing(t),t.originalEvent._simulated=!1,e.Editable.PathEditor.prototype.onDrawingMouseUp.call(this,t)},onDrawingMouseMove:function(t){t.originalEvent._simulated=!1,e.Editable.PathEditor.prototype.onDrawingMouseMove.call(this,t)},getDefaultLatLngs:function(t){return t||this.feature._latlngs[0]},updateBounds:function(t){this.feature._bounds=t},updateLatLngs:function(t){for(var n=this.getDefaultLatLngs(),l=this.feature._boundsToLatLngs(t),f=0;f<n.length;f++)n[f].update(l[f])}}),e.Editable.CircleEditor=e.Editable.PathEditor.extend({MIN_VERTEX:2,options:{skipMiddleMarkers:!0},initialize:function(t,n,l){e.Editable.PathEditor.prototype.initialize.call(this,t,n,l),this._resizeLatLng=this.computeResizeLatLng()},computeResizeLatLng:function(){var t=(this.feature._radius||this.feature._mRadius)*Math.cos(Math.PI/4),n=this.map.project(this.feature._latlng);return this.map.unproject([n.x+t,n.y-t])},updateResizeLatLng:function(){this._resizeLatLng.update(this.computeResizeLatLng()),this._resizeLatLng.__vertex.update()},getLatLngs:function(){return[this.feature._latlng,this._resizeLatLng]},getDefaultLatLngs:function(){return this.getLatLngs()},onVertexMarkerDrag:function(t){t.vertex.getIndex()===1?this.resize(t):this.updateResizeLatLng(t),e.Editable.PathEditor.prototype.onVertexMarkerDrag.call(this,t)},resize:function(t){var n=this.feature._latlng.distanceTo(t.latlng);this.feature.setRadius(n)},onDrawingMouseDown:function(t){e.Editable.PathEditor.prototype.onDrawingMouseDown.call(this,t),this._resizeLatLng.update(t.latlng),this.feature._latlng.update(t.latlng),this.connect(),t.originalEvent._simulated=!1,this.map.dragging._draggable._onUp(t.originalEvent),this._resizeLatLng.__vertex.dragging._draggable._onDown(t.originalEvent)},onDrawingMouseUp:function(t){this.commitDrawing(t),t.originalEvent._simulated=!1,e.Editable.PathEditor.prototype.onDrawingMouseUp.call(this,t)},onDrawingMouseMove:function(t){t.originalEvent._simulated=!1,e.Editable.PathEditor.prototype.onDrawingMouseMove.call(this,t)},onDrag:function(t){e.Editable.PathEditor.prototype.onDrag.call(this,t),this.feature.dragging.updateLatLng(this._resizeLatLng)}});var r={createEditor:function(t){t=t||this._map;var n=(this.options.editOptions||{}).editTools||t.editTools;if(!n)throw Error("Unable to detect Editable instance.");var l=this.options.editorClass||this.getEditorClass(n);return new l(t,this,this.options.editOptions)},enableEdit:function(t){return this.editor||this.createEditor(t),this.editor.enable(),this.editor},editEnabled:function(){return this.editor&&this.editor.enabled()},disableEdit:function(){this.editor&&(this.editor.disable(),delete this.editor)},toggleEdit:function(){this.editEnabled()?this.disableEdit():this.enableEdit()},_onEditableAdd:function(){this.editor&&this.enableEdit()}},s={getEditorClass:function(t){return t&&t.options.polylineEditorClass?t.options.polylineEditorClass:e.Editable.PolylineEditor},shapeAt:function(t,n){var l=null;if(n=n||this._latlngs,n.length){if(c(n)&&this.isInLatLngs(t,n))l=n;else for(var f=0;f<n.length;f++)if(this.isInLatLngs(t,n[f]))return n[f]}else return l;return l},isInLatLngs:function(t,n){if(!n)return!1;var l,f,p,v=[],w,m=this._clickTolerance();if(this._projectLatlngs(n,v,this._pxBounds),v=v[0],w=this._map.latLngToLayerPoint(t),!this._pxBounds.contains(w))return!1;for(l=1,p=v.length,f=0;l<p;f=l++)if(e.LineUtil.pointToSegmentDistance(w,v[f],v[l])<=m)return!0;return!1}},a={getEditorClass:function(t){return t&&t.options.polygonEditorClass?t.options.polygonEditorClass:e.Editable.PolygonEditor},shapeAt:function(t,n){var l=null;if(n=n||this._latlngs,n.length){if(c(n)&&this.isInLatLngs(t,n))l=n;else if(c(n[0])&&this.isInLatLngs(t,n[0]))l=n;else for(var f=0;f<n.length;f++)if(this.isInLatLngs(t,n[f][0]))return n[f]}else return l;return l},isInLatLngs:function(t,n){var l=!1,f,p,v,w,m;for(v=0,m=n.length,w=m-1;v<m;w=v++)f=n[v],p=n[w],f.lat>t.lat!=p.lat>t.lat&&t.lng<(p.lng-f.lng)*(t.lat-f.lat)/(p.lat-f.lat)+f.lng&&(l=!l);return l},parentShape:function(t,n){if(n=n||this._latlngs,!!n){var l=e.Util.indexOf(n,t);if(l!==-1)return n;for(var f=0;f<n.length;f++)if(l=e.Util.indexOf(n[f],t),l!==-1)return n[f]}}},h={getEditorClass:function(t){return t&&t.options.markerEditorClass?t.options.markerEditorClass:e.Editable.MarkerEditor}},d={getEditorClass:function(t){return t&&t.options.rectangleEditorClass?t.options.rectangleEditorClass:e.Editable.RectangleEditor}},u={getEditorClass:function(t){return t&&t.options.circleEditorClass?t.options.circleEditorClass:e.Editable.CircleEditor}},g=function(){this.on("add",this._onEditableAdd)},c=e.LineUtil.isFlat||e.LineUtil._flat||e.Polyline._flat;e.Polyline&&(e.Polyline.include(r),e.Polyline.include(s),e.Polyline.addInitHook(g)),e.Polygon&&(e.Polygon.include(r),e.Polygon.include(a)),e.Marker&&(e.Marker.include(r),e.Marker.include(h),e.Marker.addInitHook(g)),e.Rectangle&&(e.Rectangle.include(r),e.Rectangle.include(d)),e.Circle&&(e.Circle.include(r),e.Circle.include(u)),e.LatLng.prototype.update=function(t){t=e.latLng(t),this.lat=t.lat,this.lng=t.lng}},window)})(Pt);const St=b.default.Control.extend({options:{position:"topright",callback:()=>{}},onAdd:function(){const o=this._container=b.default.DomUtil.create("div","leaflet-bar");this._container.style.background="#ffffff",this._container.style.padding="10px",o.innerHTML=`
      <form>
        <ul style="list-style:none; padding-left: 0">
          <li> <label> <input type="radio" name="op" value="0" checked />   Intersection </label> </li>
          <li> <label> <input type="radio" name="op" value="1" />   Union </label> </li>
          <li> <label> <input type="radio" name="op" value="2" />   Difference A - B </label> </li>
          <li> <label> <input type="radio" name="op" value="5" />   Difference B - A </label> </li>
          <li> <label> <input type="radio" name="op" value="3" />   Xor </label> </li>
        </ul>
        <input type="submit" value="Run">
        <input name="clear" type="button" value="Clear layers">
      </form>`;const i=o.querySelector("form");return b.default.DomEvent.on(i,"submit",e=>{b.default.DomEvent.stop(e);const r=Array.prototype.slice.call(i.querySelectorAll("input[type=radio]"));for(let s=0,a=r.length;s<a;s++)if(r[s].checked){this.options.callback(parseInt(r[s].value));break}},this).on(i.clear,"click",e=>{b.default.DomEvent.stop(e),this.options.clear()},this),b.default.DomEvent.disableClickPropagation(this._container).disableScrollPropagation(this._container),this._container}}),At=b.default.Control.extend({options:{position:"bottomright"},onAdd:function(o){return this._container=b.default.DomUtil.create("div","leaflet-bar"),this._container.style.background="#ffffff",o.on("mousemove",this._onMouseMove,this),this._container},_onMouseMove:function(o){this._container.innerHTML='<span style="padding: 5px">'+o.latlng.lng.toFixed(3)+", "+o.latlng.lat.toFixed(3)+"</span>"}}),Tt=b.default.Control.extend({options:{position:"topleft",callback:null,kind:"",html:""},onAdd:function(o){const i=b.default.DomUtil.create("div","leaflet-control leaflet-bar"),e=b.default.DomUtil.create("a","",i);return e.href="#",e.title="Create a new "+this.options.kind,e.innerHTML=this.options.html,b.default.DomEvent.on(e,"click",b.default.DomEvent.stop).on(e,"click",function(){globalThis.LAYER=this.options.callback.call(o.editTools)},this),i}}).extend({options:{position:"topleft",kind:"polygon",html:"\u25B0",callback:()=>{}}});function Nt(o,i){return o>i?1:o<i?-1:0}class ht{constructor(i=Nt,e=!1){this._compare=i,this._root=null,this._size=0,this._noDuplicates=!!e}rotateLeft(i){var e=i.right;e&&(i.right=e.left,e.left&&(e.left.parent=i),e.parent=i.parent),i.parent?i===i.parent.left?i.parent.left=e:i.parent.right=e:this._root=e,e&&(e.left=i),i.parent=e}rotateRight(i){var e=i.left;e&&(i.left=e.right,e.right&&(e.right.parent=i),e.parent=i.parent),i.parent?i===i.parent.left?i.parent.left=e:i.parent.right=e:this._root=e,e&&(e.right=i),i.parent=e}_splay(i){for(;i.parent;){var e=i.parent;e.parent?e.left===i&&e.parent.left===e?(this.rotateRight(e.parent),this.rotateRight(e)):e.right===i&&e.parent.right===e?(this.rotateLeft(e.parent),this.rotateLeft(e)):e.left===i&&e.parent.right===e?(this.rotateRight(e),this.rotateLeft(e)):(this.rotateLeft(e),this.rotateRight(e)):e.left===i?this.rotateRight(e):this.rotateLeft(e)}}splay(i){for(var e,r,s,a,h;i.parent;)e=i.parent,r=e.parent,r&&r.parent?(s=r.parent,s.left===r?s.left=i:s.right=i,i.parent=s):(i.parent=null,this._root=i),a=i.left,h=i.right,i===e.left?(r&&(r.left===e?(e.right?(r.left=e.right,r.left.parent=r):r.left=null,e.right=r,r.parent=e):(a?(r.right=a,a.parent=r):r.right=null,i.left=r,r.parent=i)),h?(e.left=h,h.parent=e):e.left=null,i.right=e,e.parent=i):(r&&(r.right===e?(e.left?(r.right=e.left,r.right.parent=r):r.right=null,e.left=r,r.parent=e):(h?(r.left=h,h.parent=r):r.left=null,i.right=r,r.parent=i)),a?(e.right=a,a.parent=e):e.right=null,i.left=e,e.parent=i)}replace(i,e){i.parent?i===i.parent.left?i.parent.left=e:i.parent.right=e:this._root=e,e&&(e.parent=i.parent)}minNode(i=this._root){if(i)for(;i.left;)i=i.left;return i}maxNode(i=this._root){if(i)for(;i.right;)i=i.right;return i}insert(i,e){var r=this._root,s=null,a=this._compare,h;if(this._noDuplicates)for(;r;){if(s=r,h=a(r.key,i),h===0)return;a(r.key,i)<0?r=r.right:r=r.left}else for(;r;)s=r,a(r.key,i)<0?r=r.right:r=r.left;return r={key:i,data:e,left:null,right:null,parent:s},s?a(s.key,r.key)<0?s.right=r:s.left=r:this._root=r,this.splay(r),this._size++,r}find(i){for(var e=this._root,r=this._compare;e;){var s=r(e.key,i);if(s<0)e=e.right;else if(s>0)e=e.left;else return e}return null}contains(i){for(var e=this._root,r=this._compare;e;){var s=r(i,e.key);if(s===0)return!0;s<0?e=e.left:e=e.right}return!1}remove(i){var e=this.find(i);if(!e)return!1;if(this.splay(e),!e.left)this.replace(e,e.right);else if(!e.right)this.replace(e,e.left);else{var r=this.minNode(e.right);r.parent!==e&&(this.replace(r,r.right),r.right=e.right,r.right.parent=r),this.replace(e,r),r.left=e.left,r.left.parent=r}return this._size--,!0}removeNode(i){if(!i)return!1;if(this.splay(i),!i.left)this.replace(i,i.right);else if(!i.right)this.replace(i,i.left);else{var e=this.minNode(i.right);e.parent!==i&&(this.replace(e,e.right),e.right=i.right,e.right.parent=e),this.replace(i,e),e.left=i.left,e.left.parent=e}return this._size--,!0}erase(i){var e=this.find(i);if(!!e){this.splay(e);var r=e.left,s=e.right,a=null;r&&(r.parent=null,a=this.maxNode(r),this.splay(a),this._root=a),s&&(r?a.right=s:this._root=s,s.parent=a),this._size--}}pop(){var i=this._root,e=null;if(i){for(;i.left;)i=i.left;e={key:i.key,data:i.data},this.remove(i.key)}return e}next(i){var e=i;if(e)if(e.right)for(e=e.right;e&&e.left;)e=e.left;else for(e=i.parent;e&&e.right===i;)i=e,e=e.parent;return e}prev(i){var e=i;if(e)if(e.left)for(e=e.left;e&&e.right;)e=e.right;else for(e=i.parent;e&&e.left===i;)i=e,e=e.parent;return e}forEach(i){for(var e=this._root,r=[],s=!1,a=0;!s;)e?(r.push(e),e=e.left):r.length>0?(e=r.pop(),i(e,a++),e=e.right):s=!0;return this}range(i,e,r,s){const a=[],h=this._compare;let d=this._root,u;for(;a.length!==0||d;)if(d)a.push(d),d=d.left;else{if(d=a.pop(),u=h(d.key,e),u>0)break;if(h(d.key,i)>=0&&r.call(s,d))return this;d=d.right}return this}keys(){for(var i=this._root,e=[],r=[],s=!1;!s;)i?(e.push(i),i=i.left):e.length>0?(i=e.pop(),r.push(i.key),i=i.right):s=!0;return r}values(){for(var i=this._root,e=[],r=[],s=!1;!s;)i?(e.push(i),i=i.left):e.length>0?(i=e.pop(),r.push(i.data),i=i.right):s=!0;return r}at(i){for(var e=this._root,r=[],s=!1,a=0;!s;)if(e)r.push(e),e=e.left;else if(r.length>0){if(e=r.pop(),a===i)return e;a++,e=e.right}else s=!0;return null}load(i=[],e=[],r=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const s=i.length;return r&&ut(i,e,0,s-1,this._compare),this._root=dt(null,i,e,0,s),this._size=s,this}min(){var i=this.minNode(this._root);return i?i.key:null}max(){var i=this.maxNode(this._root);return i?i.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(i,e,r,s,a){return new ht(r,a).load(i,e,s)}}function dt(o,i,e,r,s){const a=s-r;if(a>0){const h=r+Math.floor(a/2),d=i[h],u=e[h],g={key:d,data:u,parent:o};return g.left=dt(g,i,e,r,h),g.right=dt(g,i,e,h+1,s),g}return null}function ut(o,i,e,r,s){if(e>=r)return;const a=o[e+r>>1];let h=e-1,d=r+1;for(;;){do h++;while(s(o[h],a)<0);do d--;while(s(o[d],a)>0);if(h>=d)break;let u=o[h];o[h]=o[d],o[d]=u,u=i[h],i[h]=i[d],i[d]=u}ut(o,i,e,d,s),ut(o,i,d+1,r,s)}const mt=0,Et=1,_t=2,bt=3,G=0,W=1,N=2,Z=3;function q(o,i,e){i===null?(o.inOut=!1,o.otherInOut=!0):(o.isSubject===i.isSubject?(o.inOut=!i.inOut,o.otherInOut=i.otherInOut):(o.inOut=!i.otherInOut,o.otherInOut=i.isVertical()?!i.inOut:i.inOut),i&&(o.prevInResult=!kt(i,e)||i.isVertical()?i.prevInResult:i)),kt(o,e)?o.resultTransition=Vt(o,e):o.resultTransition=0}function kt(o,i){switch(o.type){case mt:switch(i){case G:return!o.otherInOut;case W:return o.otherInOut;case N:return o.isSubject&&o.otherInOut||!o.isSubject&&!o.otherInOut;case Z:return!0}break;case _t:return i===G||i===W;case bt:return i===N;case Et:return!1}return!1}function Vt(o,i){let e=!o.inOut,r=!o.otherInOut,s;switch(i){case G:s=e&&r;break;case W:s=e||r;break;case Z:s=e!==r;break;case N:o.isSubject?s=e&&!r:s=r&&!e;break}return s?1:-1}class Y{constructor(i,e,r,s){y(this,"left");y(this,"isSubject");y(this,"point");y(this,"otherEvent");y(this,"type");y(this,"pos");y(this,"inOut",!1);y(this,"otherInOut",!1);y(this,"prevInResult",null);y(this,"resultInOut",!1);y(this,"isExteriorRing",!0);y(this,"contourId",-1);y(this,"resultTransition",0);y(this,"outputContourId",0);y(this,"otherPos",0);this.left=e,this.point=i,this.otherEvent=r,this.isSubject=s,this.type=mt,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(i){return tt(this,i)}isAbove(i){return!tt(this,i)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const i=new Y(this.point,this.left,this.otherEvent,this.isSubject);return i.type=this.type,i.resultTransition=this.resultTransition,i.prevInResult=this.prevInResult,i.isExteriorRing=this.isExteriorRing,i.inOut=this.inOut,i.otherInOut=this.otherInOut,i}}function tt(o,i){const e=o.point,r=o.otherEvent.point;return o.left?(e[0]-i[0])*(r[1]-i[1])-(r[0]-i[0])*(e[1]-i[1])>0:(r[0]-i[0])*(e[1]-i[1])-(e[0]-i[0])*(r[1]-i[1])>0}function A(o,i){return o[0]===i[0]?o[1]===i[1]:!1}const V=11102230246251565e-32,M=134217729,Bt=(3+8*V)*V;function ft(o,i,e,r,s){let a,h,d,u,g=i[0],c=r[0],t=0,n=0;c>g==c>-g?(a=g,g=i[++t]):(a=c,c=r[++n]);let l=0;if(t<o&&n<e)for(c>g==c>-g?(h=g+a,d=a-(h-g),g=i[++t]):(h=c+a,d=a-(h-c),c=r[++n]),a=h,d!==0&&(s[l++]=d);t<o&&n<e;)c>g==c>-g?(h=a+g,u=h-a,d=a-(h-u)+(g-u),g=i[++t]):(h=a+c,u=h-a,d=a-(h-u)+(c-u),c=r[++n]),a=h,d!==0&&(s[l++]=d);for(;t<o;)h=a+g,u=h-a,d=a-(h-u)+(g-u),g=i[++t],a=h,d!==0&&(s[l++]=d);for(;n<e;)h=a+c,u=h-a,d=a-(h-u)+(c-u),c=r[++n],a=h,d!==0&&(s[l++]=d);return(a!==0||l===0)&&(s[l++]=a),l}function Gt(o,i){let e=i[0];for(let r=1;r<o;r++)e+=i[r];return e}function et(o){return new Float64Array(o)}const jt=(3+16*V)*V,zt=(2+12*V)*V,Ut=(9+64*V)*V*V,Q=et(4),yt=et(8),Mt=et(12),Dt=et(16),I=et(4);function Ht(o,i,e,r,s,a,h){let d,u,g,c,t,n,l,f,p,v,w,m,_,k,D,x,O,C;const F=o-s,R=e-s,P=i-a,S=r-a;k=F*S,n=M*F,l=n-(n-F),f=F-l,n=M*S,p=n-(n-S),v=S-p,D=f*v-(k-l*p-f*p-l*v),x=P*R,n=M*P,l=n-(n-P),f=P-l,n=M*R,p=n-(n-R),v=R-p,O=f*v-(x-l*p-f*p-l*v),w=D-O,t=D-w,Q[0]=D-(w+t)+(t-O),m=k+w,t=m-k,_=k-(m-t)+(w-t),w=_-x,t=_-w,Q[1]=_-(w+t)+(t-x),C=m+w,t=C-m,Q[2]=m-(C-t)+(w-t),Q[3]=C;let B=Gt(4,Q),nt=zt*h;if(B>=nt||-B>=nt||(t=o-F,d=o-(F+t)+(t-s),t=e-R,g=e-(R+t)+(t-s),t=i-P,u=i-(P+t)+(t-a),t=r-S,c=r-(S+t)+(t-a),d===0&&u===0&&g===0&&c===0)||(nt=Ut*h+Bt*Math.abs(B),B+=F*c+S*d-(P*g+R*u),B>=nt||-B>=nt))return B;k=d*S,n=M*d,l=n-(n-d),f=d-l,n=M*S,p=n-(n-S),v=S-p,D=f*v-(k-l*p-f*p-l*v),x=u*R,n=M*u,l=n-(n-u),f=u-l,n=M*R,p=n-(n-R),v=R-p,O=f*v-(x-l*p-f*p-l*v),w=D-O,t=D-w,I[0]=D-(w+t)+(t-O),m=k+w,t=m-k,_=k-(m-t)+(w-t),w=_-x,t=_-w,I[1]=_-(w+t)+(t-x),C=m+w,t=C-m,I[2]=m-(C-t)+(w-t),I[3]=C;const ve=ft(4,Q,4,I,yt);k=F*c,n=M*F,l=n-(n-F),f=F-l,n=M*c,p=n-(n-c),v=c-p,D=f*v-(k-l*p-f*p-l*v),x=P*g,n=M*P,l=n-(n-P),f=P-l,n=M*g,p=n-(n-g),v=g-p,O=f*v-(x-l*p-f*p-l*v),w=D-O,t=D-w,I[0]=D-(w+t)+(t-O),m=k+w,t=m-k,_=k-(m-t)+(w-t),w=_-x,t=_-w,I[1]=_-(w+t)+(t-x),C=m+w,t=C-m,I[2]=m-(C-t)+(w-t),I[3]=C;const me=ft(ve,yt,4,I,Mt);k=d*c,n=M*d,l=n-(n-d),f=d-l,n=M*c,p=n-(n-c),v=c-p,D=f*v-(k-l*p-f*p-l*v),x=u*g,n=M*u,l=n-(n-u),f=u-l,n=M*g,p=n-(n-g),v=g-p,O=f*v-(x-l*p-f*p-l*v),w=D-O,t=D-w,I[0]=D-(w+t)+(t-O),m=k+w,t=m-k,_=k-(m-t)+(w-t),w=_-x,t=_-w,I[1]=_-(w+t)+(t-x),C=m+w,t=C-m,I[2]=m-(C-t)+(w-t),I[3]=C;const Ee=ft(me,Mt,4,I,Dt);return Dt[Ee-1]}function Kt(o,i,e,r,s,a){const h=(i-a)*(e-s),d=(o-s)*(r-a),u=h-d;if(h===0||d===0||h>0!=d>0)return u;const g=Math.abs(h+d);return Math.abs(u)>=jt*g?u:-Ht(o,i,e,r,s,a,g)}function ct(o,i,e){const r=Kt(o[0],o[1],i[0],i[1],e[0],e[1]);return r>0?-1:r<0?1:0}function j(o,i){const e=o.point,r=i.point;return e[0]>r[0]?1:e[0]<r[0]?-1:e[1]!==r[1]?e[1]>r[1]?1:-1:Xt(o,i,e)}function Xt(o,i,e){return o.left!==i.left?o.left?1:-1:ct(e,o.otherEvent.point,i.otherEvent.point)!==0?tt(o,i.otherEvent.point)?-1:1:!o.isSubject&&i.isSubject?1:-1}function z(o,i,e){const r=new Y(i,!1,o,o.isSubject),s=new Y(i,!0,o.otherEvent,o.isSubject);return A(o.point,o.otherEvent.point)&&console.warn("what is that, a collapsed segment?",o),r.contourId=s.contourId=o.contourId,j(s,o.otherEvent)>0&&(o.otherEvent.left=!0,s.left=!1),o.otherEvent.otherEvent=s,o.otherEvent=r,e.push(s),e.push(r),e}const rt=(o,i,e,r)=>o*r-i*e,gt=(o,i,e,r)=>o*e+i*r,J=(o,i,e,r,s)=>[o+e*r,i+e*s];function Wt(o,i,e,r,s){const a=i[0]-o[0],h=i[1]-o[1],d=r[0]-e[0],u=r[1]-e[1],g=e[0]-o[0],c=e[1]-o[1];let t=rt(a,h,d,u),n=t*t;const l=gt(a,h,a,h);if(n>0){const m=rt(g,c,d,u)/t;if(m<0||m>1)return null;const _=rt(g,c,a,h)/t;return _<0||_>1?null:m===0||m===1?s?null:[J(o[0],o[1],m,a,h)]:_===0||_===1?s?null:[J(e[0],e[1],_,d,u)]:[J(o[0],o[1],m,a,h)]}if(t=rt(g,c,a,h),n=t*t,n>0)return null;const f=gt(a,h,g,c)/l,p=f+gt(a,h,d,u)/l,v=Math.min(f,p),w=Math.max(f,p);return v<=1&&w>=0?v===1?s?null:[J(o[0],o[1],v>0?v:0,a,h)]:w===0?s?null:[J(o[0],o[1],w<1?w:1,a,h)]:s&&v===0&&w===1?null:[J(o[0],o[1],v>0?v:0,a,h),J(o[0],o[1],w<1?w:1,a,h)]:null}function pt(o,i,e){const r=Wt(o.point,o.otherEvent.point,i.point,i.otherEvent.point,!1),s=r?r.length:0;if(s===0||s===1&&(A(o.point,i.point)||A(o.otherEvent.point,i.otherEvent.point))||s===2&&o.isSubject===i.isSubject)return 0;if(s===1){const u=r[0];return!A(o.point,u)&&!A(o.otherEvent.point,u)&&z(o,u,e),!A(i.point,u)&&!A(i.otherEvent.point,u)&&z(i,u,e),1}const a=[];let h=!1,d=!1;return A(o.point,i.point)?h=!0:j(o,i)===1?a.push(i,o):a.push(o,i),A(o.otherEvent.point,i.otherEvent.point)?d=!0:j(o.otherEvent,i.otherEvent)===1?a.push(i.otherEvent,o.otherEvent):a.push(o.otherEvent,i.otherEvent),h&&d||h?(i.type=Et,o.type=i.inOut===o.inOut?_t:bt,h&&!d&&z(a[1].otherEvent,a[0].point,e),2):d?(z(a[0],a[1].point,e),3):a[0]!==a[3].otherEvent?(z(a[0],a[1].point,e),z(a[1],a[2].point,e),3):(z(a[0],a[1].point,e),z(a[3].otherEvent,a[2].point,e),3)}function Jt(o,i){if(o===i)return 0;if(ct(o.point,o.otherEvent.point,i.point)!==0||ct(o.point,o.otherEvent.point,i.otherEvent.point)!==0)return A(o.point,i.point)?tt(o,i.otherEvent.point)?-1:1:o.point[0]===i.point[0]?o.point[1]<i.point[1]?-1:1:j(o,i)===1?i.isAbove(o.point)?-1:1:tt(o,i.point)?-1:1;if(o.isSubject===i.isSubject){let e=o.point,r=i.point;if(e[0]===r[0]&&e[1]===r[1])return e=o.otherEvent.point,r=i.otherEvent.point,e[0]===r[0]&&e[1]===r[1]?0:o.contourId>i.contourId?1:-1}else return o.isSubject?-1:1;return j(o,i)===1?1:-1}function Zt(o,i,e,r){const s=new ht(Jt),a=[],h=Math.min(i[2],e[2]);let d,u,g=s.minNode();for(;o.length!==0;){let c=o.pop();if(a.push(c),r===G&&c.point[0]>h||r===N&&c.point[0]>i[2])break;if(c.left){u=d=s.insert(c),g=s.minNode(),d!==g?d=s.prev(d):d=null,u=s.next(u);const t=d?d.key:null;let n;if(q(c,t,r),u&&pt(c,u.key,o)===2&&(q(c,t,r),q(u.key,c,r)),d&&pt(d.key,c,o)===2){let l=d;l!==g?l=s.prev(l):l=null,n=l?l.key:null,q(t,n,r),q(c,t,r)}}else c=c.otherEvent,u=d=s.find(c),d&&u&&(d!==g?d=s.prev(d):d=null,u=s.next(u),s.remove(c),u&&d&&pt(d.key,u.key,o))}return a}class Yt{constructor(){y(this,"points",[]);y(this,"holeIds",[]);y(this,"holeOf",null);y(this,"depth",0)}isExterior(){return this.holeOf===null}}const Qt=[0,0];function $t(o){const i=[];for(let r=0,s=o.length;r<s;r++){const a=o[r];(a.left&&a.inResult||!a.left&&a.otherEvent.inResult)&&i.push(a)}let e=!1;for(;!e;){e=!0;for(let r=0,s=i.length;r<s;r++)if(r+1<s&&j(i[r],i[r+1])===1){const a=i[r];i[r]=i[r+1],i[r+1]=a,e=!1}}for(let r=0,s=i.length;r<s;r++)i[r].otherPos=r;for(let r=0,s=i.length;r<s;r++){const a=i[r];if(!a.left){const h=a.otherPos;a.otherPos=a.otherEvent.otherPos,a.otherEvent.otherPos=h}}return i}function qt(o,i,e,r){let s=o+1;const a=i[o].point;let h=Qt;const d=i.length;for(s<d&&(h=i[s].point);s<d&&h[0]===a[0]&&h[1]===a[1];){if(e.has(s))s++;else return s;s<d&&(h=i[s].point)}for(s=o-1;e.has(s)&&s>r;)s--;return s}function te(o,i,e){const r=new Yt;if(o.prevInResult!=null){const s=o.prevInResult,a=s.outputContourId;if(s.resultTransition>0){const d=i[a];if(d.holeOf!=null){const u=d.holeOf;i[u].holeIds.push(e),r.holeOf=u,r.depth=i[a].depth}else i[a].holeIds.push(e),r.holeOf=a,r.depth=i[a].depth+1}else r.holeOf=null,r.depth=i[a].depth}else r.holeOf=null,r.depth=0;return r}function ee(o){const i=$t(o),e=new Set,r=[];for(let s=0,a=i.length;s<a;s++){if(e.has(s))continue;const h=r.length,d=te(i[s],r,h),u=n=>{e.add(n),n<i.length&&i[n]&&(i[n].outputContourId=h)};let g=s,c=s;const t=i[s].point;for(d.points.push(t);u(g),g=i[g].otherPos,u(g),d.points.push(i[g].point),g=qt(g,i,e,c),!(g==c||g>=i.length||!i[g]););r.push(d)}return r}class ie{constructor(i=[],e=ne){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:r}=this,s=e[i];for(;i>0;){const a=i-1>>1,h=e[a];if(r(s,h)>=0)break;e[i]=h,i=a}e[i]=s}_down(i){const{data:e,compare:r}=this,s=this.length>>1,a=e[i];for(;i<s;){let h=(i<<1)+1,d=e[h];const u=h+1;if(u<this.length&&r(e[u],d)<0&&(h=u,d=e[u]),r(d,a)>=0)break;e[i]=d,i=h}e[i]=a}}function ne(o,i){return o<i?-1:o>i?1:0}const Lt=Math.max,xt=Math.min;let ot=0;function Ct(o,i,e,r,s,a){for(let h=0,d=o.length-1;h<d;h++){const u=o[h],g=o[h+1],c=new Y(u,!1,null,i),t=new Y(g,!1,c,i);if(c.otherEvent=t,u[0]===g[0]&&u[1]===g[1])continue;c.contourId=t.contourId=e,a||(c.isExteriorRing=!1,t.isExteriorRing=!1),j(c,t)>0?t.left=!0:c.left=!0;const[n,l]=u;s[0]=xt(s[0],n),s[1]=xt(s[1],l),s[2]=Lt(s[2],n),s[3]=Lt(s[3],l),r.push(c),r.push(t)}}function re(o,i,e,r,s){const a=new ie(void 0,j);let h,d;for(let u=0,g=o.length;u<g;u++){h=o[u];for(let c=0,t=h.length;c<t;c++)d=c===0,d&&ot++,Ct(h[c],!0,ot,a,e,d)}for(let u=0,g=i.length;u<g;u++){h=i[u];for(let c=0,t=h.length;c<t;c++)d=c===0,s===N&&(d=!1),d&&ot++,Ct(h[c],!1,ot,a,r,d)}return a}const st=[];function oe(o,i,e){if(o.length*i.length===0){if(e===G)return st;if(e===N)return o;if(e===W||e===Z)return o.length===0?i:o}return null}function se(o,i,e,r,s){if(e[0]>r[2]||r[0]>e[2]||e[1]>r[3]||r[1]>e[3]){if(s===G)return st;if(s===N)return o;if(s===W||s===Z)return o.concat(i)}return null}function at(o,i,e){const r=typeof o[0][0][0]=="number"?[o]:o,s=typeof i[0][0][0]=="number"?[i]:i;let a=oe(r,s,e);if(a)return a===st?null:a;const h=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],u=re(r,s,h,d,e);if(a=se(r,s,h,d,e),a)return a===st?null:a;const g=Zt(u,h,d,e),c=ee(g),t=[];for(let n=0;n<c.length;n++){const l=c[n];if(l.isExterior()){const f=[l.points];for(let p=0;p<l.holeIds.length;p++){const v=l.holeIds[p];f.push(c[v].points)}t.push(f)}}return t}const ae=(o,i)=>at(o,i,W),It=(o,i)=>at(o,i,N),le=(o,i)=>at(o,i,Z),he=(o,i)=>at(o,i,G),de={UNION:W,DIFFERENCE:N,INTERSECTION:G,XOR:Z};let Ot=globalThis.location.hash.substring(1),ue="/",E;switch(Ot){case"geo":E="asia.geojson";break;case"states":E="states_source.geojson";break;case"trapezoid":E="trapezoid-box.geojson";break;case"canada":E="canada.geojson";break;case"horseshoe":E="horseshoe.geojson";break;case"hourglasses":E="hourglasses.geojson";break;case"edge_overlap":E="polygon_trapezoid_edge_overlap.geojson";break;case"touching_boxes":E="touching_boxes.geojson";break;case"triangles":E="two_pointed_triangles.geojson";break;case"holecut":E="hole_cut.geojson";break;case"overlapping_segments":E="overlapping_segments.geojson";break;case"overlap_loop":E="overlap_loop.geojson";break;case"overlap_y":E="overlap_y.geojson";break;case"overlap_two":E="overlap_two.geojson";break;case"disjoint_boxes":E="disjoint_boxes.geojson";break;case"polygons_edge_overlap":E="polygons_edge_overlap.geojson";break;case"vertical_boxes":E="vertical_boxes.geojson";break;case"collapsed":E="collapsed.geojson";break;case"fatal1":E="fatal1.geojson";break;case"fatal2":E="fatal2.geojson";break;case"fatal3":E="fatal3.geojson";break;case"fatal4":E="fatal4.geojson";break;case"rectangles":E="rectangles.geojson";break;default:E="hole_hole.geojson";break}const $=de;var lt=document.createElement("div");lt.id="image-map",lt.style.width=lt.style.height="100%",document.body.appendChild(lt);const U=globalThis.map=b.default.map("image-map",{minZoom:1,maxZoom:20,center:[0,0],zoom:2,crs:Ot==="geo"?b.default.CRS.EPSG4326:b.default.extend({},b.default.CRS.Simple,{transformation:new b.default.Transformation(1/8,0,-1/8,0)}),editable:!0});U.addControl(new Tt({callback:U.editTools.startPolygon})),U.addControl(new At),U.addControl(new St({callback:we,clear:ce}));var it=globalThis.drawnItems=b.default.geoJSON().addTo(U),H=null;function fe(o){console.log(o),fetch(o).then(i=>i.json()).then(i=>{it.addData(i),H=i,U.fitBounds(it.getBounds().pad(.05),{animate:!1})})}function ce(){it.clearLayers(),wt.clearLayers(),H=null}const Ft=new vt.io.GeoJSONReader,ge=new vt.io.GeoJSONWriter;function pe(o){return H&&H.features&&H.features.length>1?H.features[1]:o[1].toGeoJSON()}function we(o){var i=it.getLayers();if(!(i.length<2)){var e=H!==null?H.features[0]:i[0].toGeoJSON(),r=pe(i),s;if(o===$.INTERSECTION)s=he;else if(o===$.UNION)s=ae;else if(o===$.DIFFERENCE)s=It;else if(o===5){s=It;var a=e;e=r,r=a}else s=le;console.time("martinez");var h=s(e.geometry.coordinates,r.geometry.coordinates);console.timeEnd("martinez"),console.log("result",h),wt.clearLayers(),h!==null&&(wt.addData({type:"Feature",geometry:{type:"MultiPolygon",coordinates:h}}),setTimeout(function(){console.time("jsts");var d=Ft.read(e),u=Ft.read(r),g;o===$.INTERSECTION?g=d.geometry.intersection(u.geometry):o===$.UNION?g=d.geometry.union(u.geometry):o===$.DIFFERENCE?g=d.geometry.difference(u.geometry):g=d.geometry.symDifference(u.geometry),g=ge.write(g),console.timeEnd("jsts")},500))}}U.on("editable:created",function(o){it.addLayer(o.layer),o.layer.on("click",function(i){(i.originalEvent.ctrlKey||i.originalEvent.metaKey)&&this.editEnabled()&&this.editor.newHole(i.latlng)})});var wt=globalThis.results=b.default.geoJson(null,{style:function(){return{color:"red",weight:1}}}).addTo(U);fe(ue+E)})(L,jsts);
